<div class="space-y-4">
  <div class="flex flex-col gap-2">
    <h1
      class="text-3xl font-bold bg-gradient-to-r from-primary to-accent text-transparent bg-clip-text"
    >
      Comunidad
    </h1>
    <p class="text-base text-base-content/70">
      Comparte y descubre experiencias que inspiran ✨
    </p>
  </div>

  <!-- FILTERS -->
  <div class="card bg-base-100 shadow-lg">
    <div class="card-body p-4 space-y-3">
      <!-- Header with Clear Button -->
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <i class="material-symbols-outlined text-primary">filter_alt</i>
          <span class="font-semibold">Filtros</span>
        </div>
        @if (search() || category() || type() !== "default") {
          <button
            type="button"
            class="btn btn-ghost btn-sm gap-1"
            (click)="clearFilters()"
          >
            <i class="material-symbols-outlined !text-base">clear_all</i>
            Limpiar
          </button>
        }
      </div>

      <!-- Search -->
      <label class="input input-bordered flex items-center gap-2">
        <i class="material-symbols-outlined text-base-content/50">search</i>
        <input
          type="search"
          class="grow"
          placeholder="Buscar posts, autores..."
          [value]="search()"
          (input)="search.set(searchInput.value)"
          #searchInput
        />
      </label>

      <!-- Category Badges Filter -->
      <div class="space-y-2">
        <div class="flex items-center gap-2">
          <i class="material-symbols-outlined text-base-content/70 !text-base"
            >category</i
          >
          <span class="text-sm font-medium text-base-content/70"
            >Categorías</span
          >
        </div>
        <div class="flex flex-wrap gap-2">
          <button
            type="button"
            class="badge badge-lg transition-all hover:scale-105"
            [class.badge-primary]="category() === ''"
            [class.badge-outline]="category() !== ''"
            (click)="category.set('')"
          >
            Todas
          </button>
          @for (cat of categories.value(); track cat.id) {
            <button
              type="button"
              class="badge badge-lg transition-all hover:scale-105"
              [class.badge-primary]="category() === cat.id"
              [class.badge-outline]="category() !== cat.id"
              (click)="category.set(cat.id)"
            >
              {{ cat.nameTranslations["es"] || cat.nameTranslations["en"] }}
            </button>
          }
        </div>
      </div>

      <!-- Type Filter -->
      <div class="space-y-2">
        <div class="flex items-center gap-2">
          <i class="material-symbols-outlined text-base-content/70 !text-base"
            >filter_list</i
          >
          <span class="text-sm font-medium text-base-content/70"
            >Ordenar por</span
          >
        </div>
        <div class="flex flex-wrap gap-2">
          <button
            type="button"
            class="badge badge-lg transition-all hover:scale-105"
            [class.badge-secondary]="type() === 'default'"
            [class.badge-outline]="type() !== 'default'"
            (click)="setType('default')"
          >
            Todos
          </button>
          <button
            type="button"
            class="badge badge-lg transition-all hover:scale-105"
            [class.badge-secondary]="type() === 'recent'"
            [class.badge-outline]="type() !== 'recent'"
            (click)="setType('recent')"
          >
            Más recientes
          </button>
          <button
            type="button"
            class="badge badge-lg transition-all hover:scale-105"
            [class.badge-secondary]="type() === 'popular'"
            [class.badge-outline]="type() !== 'popular'"
            (click)="setType('popular')"
          >
            Más populares
          </button>
          <button
            type="button"
            class="badge badge-lg transition-all hover:scale-105"
            [class.badge-secondary]="type() === 'my-blogs'"
            [class.badge-outline]="type() !== 'my-blogs'"
            (click)="setType('my-blogs')"
          >
            Mis publicaciones
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Button -->
  <button
    class="btn bg-gradient-to-r from-primary to-accent border-none text-primary-content w-full shadow-lg hover:shadow-xl transition-all"
    (click)="goToCreateBlog()"
  >
    <i class="material-symbols-outlined !text-xl">add_circle</i>
    Compartir tu experiencia
  </button>
</div>

<!-- BLOG LIST -->
<div class="flex flex-col my-3 gap-7">
  @if (blogs.isLoading()) {
    @for (i of [1, 2, 3]; track $index) {
      <div class="card bg-base-100 w-full shadow-lg">
        <figure
          class="w-full h-52 bg-base-200 skeleton flex items-center justify-center"
        ></figure>
        <div class="card-body">
          <div class="flex gap-3 items-center">
            <div
              class="skeleton w-12 h-12 rounded-full avatar avatar-placeholder"
            ></div>
            <div class="flex-1 flex-col flex gap-2">
              <div class="skeleton h-3 w-1/3"></div>
              <div class="skeleton h-2 w-1/4"></div>
            </div>
          </div>
          <div class="flex items-center justify-between my-2">
            <div class="skeleton h-5 w-1/2"></div>
          </div>
          <div class="skeleton h-3 w-full"></div>
          <div class="skeleton h-3 w-full"></div>
          <div class="card-actions justify-end items-center">
            <div class="btn btn-outline btn-primary btn-sm">
              <span class="loading loading-spinner"></span>
            </div>
          </div>
        </div>
      </div>
    }
  } @else if (blogs.error()) {
    <div class="alert alert-error my-3 flex-1">
      <i class="material-symbols-outlined !text-xl">error</i>
      <span>Error al cargar los blogs. Por favor intenta de nuevo.</span>
      <button class="btn btn-sm btn-outline hover:btn-error" (click)="reload()">
        <i class="material-symbols-outlined !text-xl">refresh</i>
      </button>
    </div>
  } @else {
    @for (blog of filteredBlogs(); track blog.id) {
      <div
        class="card card-border bg-base-100 w-full shadow-lg hover:scale-[1.01] transition-all duration-300 hover:cursor-pointer hover:shadow-xl"
        (click)="goToBlog(blog.id)"
      >
        @if (blog.mediaType === "VIDEO" && blog.mediaUrl) {
          <figure
            class="aspect-video w-full max-h-72 sm:max-h-52 bg-base-200 flex items-center justify-center"
          >
            <video class="w-full h-full">
              <source [src]="blog.mediaUrl" type="video/mp4" />
            </video>
          </figure>
        } @else if (blog.mediaType === "IMAGE" && blog.mediaUrl) {
          <figure
            class="aspect-video w-full max-h-72 sm:max-h-52 bg-base-200 flex items-center justify-center"
          >
            <img
              [src]="blog.mediaUrl"
              [alt]="blog.title"
              class="w-full max-h-72 sm:max-h-52 h-full object-cover object-center sm:object-contain"
            />
          </figure>
        }
        <div class="card-body">
          <div class="flex gap-3">
            <div class="avatar avatar-placeholder">
              <div
                class="bg-gradient-to-r from-primary to-accent text-primary-content w-12 rounded-full font-semibold"
              >
                @if (blog.author.profileImage) {
                  <img
                    [src]="blog.author.profileImage"
                    [alt]="blog.author.fullName"
                  />
                } @else {
                  <span class="">{{ getUserLetters(blog.author) }}</span>
                }
              </div>
            </div>
            <div class="w-full">
              <div class="font-semibold">{{ blog.author.fullName }}</div>
              <div class="flex items-center gap-2">
                @if (blog.createdAt) {
                  <relative-time
                    class="text-sm opacity-80"
                    [datetime]="blog.createdAt.toDate()"
                    precision="day"
                  ></relative-time>
                } @else {
                  <span class="text-xs opacity-80">No date</span>
                }
              </div>
            </div>
          </div>

          <h2 class="card-title">{{ blog.title }}</h2>
          <div class="badge badge-soft rounded-full badge-primary">
            {{ getCategoryName(blog.categoryId) }}
          </div>
          <p class="line-clamp-2">{{ blog.content }}</p>
          <div class="card-actions justify-end">
            <div class="flex-1 flex gap-4">
              <button
                class="flex items-center justify-center gap-1 hover:cursor-pointer hover:scale-[1.1] transition-all duration-300 hover:text-error text-base-content/60"
                [class.text-error]="blog.isLiked"
              >
                <i class="material-icons-outlined !text-2xl">{{
                  blog.isLiked ? "favorite" : "favorite_border"
                }}</i>
                <span class="text-base">{{ blog.reaction || 0 }}</span>
              </button>
              <button
                class="flex items-center justify-center gap-1 hover:cursor-pointer hover:scale-[1.1] transition-all duration-300 hover:text-info text-base-content/60"
                (click)="goToBlogCommentSection($event, blog.id)"
              >
                <i class="material-symbols-outlined !text-2xl">comment</i>
                <span class="text-base">{{ blog.comments || 0 }}</span>
              </button>
              <button
                class="flex items-center justify-center gap-1 hover:cursor-pointer hover:scale-[1.1] transition-all duration-300 hover:text-success text-base-content/60"
              >
                <i class="material-symbols-outlined !text-2xl">ios_share</i>
              </button>
            </div>
            <button
              class="btn btn-outline btn-primary btn-sm"
              (click)="goToBlog(blog.id)"
            >
              Leer más
            </button>
          </div>
        </div>
      </div>
    } @empty {
      <div class="text-center my-6">
        <i
          class="material-symbols-outlined !text-7xl overflow-hidden max-w-36 rounded-full bg-gradient-to-l from-primary to-accent w-fit mx-auto text-transparent bg-clip-text"
          >search</i
        >
        <h1
          class="text-3xl font-bold bg-gradient-to-r from-primary to-primary bg-clip-text text-transparent my-1"
        >
          No se encontraron posts
        </h1>
        <p class="text-lg text-base-content/80 mb-6">
          Intenta con otros términos de búsqueda o explora diferentes
          categorías.
        </p>
      </div>
    }
  }
</div>
