<div class="max-w-2xl mx-auto space-y-4">
  <!-- Header with Back Button -->
  <div class="flex items-center gap-3">
    <button type="button" class="btn btn-circle btn-ghost" (click)="goBack()">
      <i class="material-symbols-outlined">arrow_back</i>
    </button>
    <h2
      class="text-3xl font-semibold bg-gradient-to-r from-primary to-accent text-transparent bg-clip-text flex-1"
    >
      {{ title() }}
    </h2>
  </div>

  <form [formGroup]="blogForm" (ngSubmit)="onSubmit()" class="space-y-4">
    <!-- Title -->
    <fieldset class="fieldset">
      <legend class="fieldset-legend text-base font-medium">Título</legend>
      <input
        type="text"
        class="input input-bordered w-full"
        [class.input-error]="isValidField('title')"
        formControlName="title"
        placeholder="Título del post"
        minlength="3"
        required
        autocomplete="off"
      />
      @if (isValidField("title")) {
        <p class="text-error text-sm mt-1">
          {{ getFieldError("title") }}
        </p>
      }
    </fieldset>

    <!-- Content -->
    <fieldset class="fieldset">
      <legend class="fieldset-legend text-base font-medium">Contenido</legend>
      <textarea
        class="textarea textarea-bordered w-full"
        [class.textarea-error]="isValidField('content')"
        formControlName="content"
        placeholder="Comparte tu experiencia..."
        required
        minlength="5"
        rows="6"
        autocomplete="off"
      ></textarea>
      @if (isValidField("content")) {
        <p class="text-error text-sm mt-1">
          {{ getFieldError("content") }}
        </p>
      }
    </fieldset>

    <!-- Media Upload -->
    <fieldset class="fieldset">
      <legend class="fieldset-legend text-base font-medium">
        <i class="material-symbols-outlined !text-base align-middle">image</i>
        Imagen o Video (opcional)
      </legend>

      <div class="space-y-3">
        <!-- File Input (Hidden) -->
        <input
          #mediaInput
          type="file"
          id="mediaInput"
          class="hidden"
          accept="image/jpeg,image/jpg,image/png,image/gif,image/webp,video/mp4,video/webm"
          (change)="onFileChange($event)"
        />

        <!-- Buttons -->
        <div class="flex gap-2">
          <button
            type="button"
            class="btn btn-outline btn-primary flex-1"
            (click)="mediaInput.click()"
            [disabled]="isUploading()"
          >
            <i class="material-symbols-outlined !text-xl"
              >add_photo_alternate</i
            >
            Seleccionar archivo
          </button>

          @if (selectedFile() || existingMediaUrl()) {
            <button
              type="button"
              class="btn btn-outline btn-error"
              (click)="clearMedia()"
              [disabled]="isUploading()"
            >
              <i class="material-symbols-outlined !text-xl">close</i>
              Limpiar
            </button>
          }
        </div>

        <!-- Upload Progress -->
        @if (isUploading()) {
          <div class="alert alert-info">
            <span class="loading loading-spinner"></span>
            <span>Subiendo archivo...</span>
          </div>
        }

        <!-- Preview -->
        @if (previewUrl() || existingMediaUrl()) {
          <div class="card bg-base-200 shadow-md">
            <div class="card-body p-4">
              <div class="flex items-center gap-2 mb-2">
                <i class="material-symbols-outlined text-primary">visibility</i>
                <span class="font-medium">Vista previa</span>
              </div>

              @if (mediaType() === "VIDEO") {
                <video
                  [src]="previewUrl() || existingMediaUrl()"
                  controls
                  class="w-full max-h-64 rounded-lg"
                >
                  Tu navegador no soporta el elemento de video.
                </video>
              } @else {
                <img
                  [src]="previewUrl() || existingMediaUrl()"
                  [alt]="'Preview'"
                  class="w-full max-h-64 object-contain rounded-lg"
                />
              }
            </div>
          </div>
        }

        <p class="text-sm text-base-content/60">
          <i class="material-symbols-outlined !text-sm align-middle">info</i>
          Formatos: JPG, PNG, GIF, WEBP (máx. 10MB) o MP4, WEBM (máx. 50MB)
        </p>
      </div>
    </fieldset>

    <!-- Category -->
    <fieldset class="fieldset">
      <legend class="fieldset-legend text-base font-medium">
        <i class="material-symbols-outlined !text-base align-middle"
          >category</i
        >
        Categoría
      </legend>
      <select
        class="select select-bordered w-full"
        [class.select-error]="isValidField('categoryId')"
        formControlName="categoryId"
        required
      >
        <option value="">-- Seleccionar categoría --</option>
        @for (category of categories.value(); track category.id) {
          <option [value]="category.id">
            {{
              category.nameTranslations["es"] || category.nameTranslations["en"]
            }}
          </option>
        }
      </select>
      @if (isValidField("categoryId")) {
        <p class="text-error text-sm mt-1">
          {{ getFieldError("categoryId") }}
        </p>
      }
    </fieldset>

    <!-- Submit Button -->
    <div class="pt-4">
      <button
        class="btn btn-primary w-full"
        [disabled]="blogForm.invalid || isLoading() || isUploading()"
        type="submit"
      >
        @if (isLoading() || isUploading()) {
          <span class="loading loading-spinner"></span>
        }
        {{ nameButton() }}
      </button>
    </div>
  </form>
</div>
