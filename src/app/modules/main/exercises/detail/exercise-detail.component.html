<!--Contenedor principal-->
<div class="sm:p-6 md:p-8">
  <div class="max-w-4xl mx-auto">
    <!--1. Estado de Carga-->
    @if (exerciseResource.isLoading()) {
      <div class="space-y-6">
        <!--Skeleton del encabezado-->
        <div class="skeleton h-8 w-16 rounded-lg"></div>
        <div class="skeleton h-10 w-3/4 rounded-lg"></div>
        <div class="flex gap-2">
          <div class="skeleton h-6 w-24 rounded-full"></div>
          <div class="skeleton h-6 w-24 rounded-full"></div>
          <div class="skeleton h-6 w-24 rounded-full"></div>
        </div>
        <div class="divider"></div>
        <!--Skeleton del contenido-->
        <div class="skeleton h-64 w-full rounded-box"></div>
        <div class="space-y-2">
          <div class="skeleton h-4 w-full"></div>
          <div class="skeleton h-4 w-full"></div>
          <div class="skeleton h-4 w-3/4"></div>
        </div>
        <!--Skeleton del botón-->
        <div class="skeleton h-12 w-full mt-4 rounded-lg"></div>
      </div>
    } @else if (exerciseResource.error()) {
      <div class="alert alert-error">
        <span class="material-symbols-outlined">error</span>
        <span>Error al cargar el ejercicio. Por favor, intenta de nuevo.</span>
        <button class="btn btn-sm btn-ghost" (click)="reload()">
          Reintentar
        </button>
      </div>
    } @else if (!exerciseResource.value()) {
      <div role="alert" class="alert alert-warning">
        <span class="material-symbols-outlined">search_off</span>
        <div>
          <h3 class="font-bold">Ejercicio no encontrado</h3>
          <div class="text-xs">
            El ejercicio que buscas no existe o no está disponible.
          </div>
        </div>
        <a class="btn btn-sm" (click)="goBack()">Volver</a>
      </div>
    } @else {
      @if (exerciseResource.value(); as exercise) {
        <div class="card bg-base-100 shadow-xl border border-base-300/50">
          <div class="card-body">
            <!--Encabezado con botón de regreso-->
            <div class="mb-4">
              <button class="btn btn-ghost btn-sm" (click)="goBack()">
                <span class="material-symbols-outlined">arrow_back</span>
                Volver
              </button>
            </div>

            <!--Título y Metadatos-->
            <h1
              class="card-title text-3xl md:text-4xl font-extrabold tracking-tight mb-2"
            >
              {{ exercise.localizedTitle["es"] }}
            </h1>
            <div class="flex flex-wrap gap-2 mb-4 text-sm">
              <div class="badge badge-secondary badge-outline gap-2">
                <span class="material-symbols-outlined !text-base"
                  >signal_cellular_alt</span
                >
                {{ exercise.difficulty }}
              </div>
              <div class="badge badge-accent badge-outline gap-2">
                <span class="material-symbols-outlined !text-base">timer</span>
                {{ exercise.durationMinutes || 0 }} min
              </div>
            </div>

            <div class="divider"></div>

            <!--Contenido dinámico del ejercicio-->
            <div class="">
              @switch (exercise.contentType) {
                @case ("VIDEO") {
                  <!-- Reproductor de Video -->
                  <div class="w-full max-w-3xl mx-auto">
                    <div
                      class="relative w-full pt-[56.25%] rounded-xl overflow-hidden shadow-lg bg-black"
                    >
                      @if (safeVideoUrl(); as videoUrl) {
                        <iframe
                          [src]="videoUrl"
                          class="absolute top-0 left-0 w-full h-full"
                          frameborder="0"
                          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                          allowfullscreen
                        ></iframe>
                      } @else if (isStandardVideo()) {
                        <video
                          class="absolute top-0 left-0 w-full h-full object-cover"
                          controls
                          [src]="exercise.contentUrl"
                        ></video>
                      }
                    </div>
                  </div>
                }
                @case ("TEXT") {
                  <!--Contenido de texto con imagen-->
                  @if (exercise.thumbnailUrl) {
                    <figure class="mb-6">
                      <img
                        [src]="exercise.thumbnailUrl"
                        [alt]="exercise.localizedTitle['es']"
                        class="rounded-xl w-full max-h-96 object-cover shadow-md"
                      />
                    </figure>
                  }
                  <div class="prose prose-lg max-w-none">
                    <p>{{ exercise.localizedContentText["es"] }}</p>
                  </div>
                }
                @case ("AUDIO") {
                  <div class="card bg-base-200 shadow-inner max-w-2xl mx-auto">
                    <div class="card-body items-center text-center">
                      <div
                        class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mb-2"
                      >
                        <span
                          class="material-symbols-outlined text-4xl text-primary"
                          >headphones</span
                        >
                      </div>
                      <h3 class="card-title text-xl mb-1">Reproducir Audio</h3>
                      <p class="text-base-content/60 text-sm mb-4">
                        Escucha atentamente las instrucciones.
                      </p>

                      <audio
                        controls
                        class="w-full"
                        [src]="exercise.contentUrl"
                      >
                        Tu navegador no soporta el elemento de audio.
                      </audio>
                    </div>
                  </div>
                }
                @case ("GAME") {
                  <div class="alert alert-info shadow-md">
                    <span class="material-symbols-outlined"
                      >stadia_controller</span
                    >
                    <div>
                      <h3 class="font-bold">Juego Interactivo</h3>
                      <div class="text-xs">
                        El contenido interactivo estará disponible próximamente.
                      </div>
                    </div>
                  </div>
                }
              }
            </div>

            <!--Descripción adicional (si aplica)-->
            @if (exercise.contentType !== "TEXT") {
              <div class="divider"></div>
              <div class="prose max-w-none">
                <h3 class="font-bold">Descripción</h3>
                <p>{{ exercise.localizedDescription["es"] }}</p>
              </div>
            }

            <!--Acción-->
            <div class="card-actions justify-center mt-8">
              <button
                class="btn btn-primary btn-wide"
                (click)="markAsComplete()"
              >
                <span class="material-symbols-outlined">check_circle</span>
                Marcar como Completado
              </button>
            </div>
          </div>
        </div>
      }
    }
  </div>
</div>
