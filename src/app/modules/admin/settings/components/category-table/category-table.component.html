<div class="flex justify-between items-center gap-2 flex-wrap mb-3 p-2">
  <h1 class="sm:text-2xl text-xl font-bold">Categories</h1>
  <modal-open-button
    modalName="modal_category"
    [classes]="'btn-primary'"
    (click)="
      categoryService.selectedCategory.set({
        id: '',
        nameTranslations: { es: '', en: '' },
        isActive: true,
      })
    "
  >
    Add Category
  </modal-open-button>
</div>

<div class="overflow-x-auto">
  <table class="table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Active</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      @if (categories.isLoading()) {
        <div class="flex justify-center p-4">
          <span class="loading loading-spinner loading-lg text-primary"></span>
        </div>
      } @else if (categories.error()) {
        <td colspan="2">
          <div class="alert alert-error mt-4">
            <i class="material-symbols-outlined !text-xl">error</i>
            <span
              >Error al cargar las categor√≠as. Por favor intenta de nuevo.</span
            >
            <button class="btn btn-sm" (click)="reload()">Retry</button>
          </div>
        </td>
      } @else {
        @for (category of categories.value(); track category.id) {
          <tr class="hover:bg-base-200">
            <td>{{ category.nameTranslations["es"] || "Unknown" }}</td>
            <td>
              <input
                type="checkbox"
                class="toggle toggle-primary"
                [checked]="category.isActive"
                (change)="toggleCategory(category)"
              />
            </td>
            <td class="flex items-center gap-1">
              <modal-open-button
                [modalName]="'modal_category'"
                [type]="'icon'"
                (click)="categoryService.selectedCategory.set(category)"
              >
                <i class="material-symbols-outlined !text-xl">edit</i>
              </modal-open-button>

              <modal-open-button
                [modalName]="'modal_category_delete'"
                [type]="'icon'"
                classes="btn-ghost text-error"
                (click)="categoryService.selectedCategory.set(category)"
              >
                <i class="material-symbols-outlined !text-xl">delete</i>
              </modal-open-button>
            </td>
          </tr>
        } @empty {
          <tr>
            <td colspan="7" class="text-center">
              <p class="">No users found.</p>
            </td>
          </tr>
        }
      }
    </tbody>
  </table>
</div>

<category-modal (reload)="reload()"></category-modal>

<app-dialog
  [title]="'Delete category'"
  [message]="'Are you sure you want to delete this category?'"
  [modalName]="'modal_category_delete'"
  [buttonText]="'Delete'"
  (callback)="deleteCategory()"
></app-dialog>
