<div class="flex justify-between items-center gap-2 flex-wrap mb-3 p-2">
  <h1 class="sm:text-2xl text-xl font-bold">Actividades</h1>
  <modal-open-button
    modalName="modal_activity_category"
    [classes]="'btn-primary'"
    (click)="openCreateModal()"
  >
    Agregar Categoría
  </modal-open-button>
</div>

<div class="overflow-x-auto">
  <table class="table table-zebra">
    <thead class="bg-base-200">
      <tr>
        <th>
          <div class="flex items-center gap-2">
            <i class="material-icons-outlined text-sm">category</i>
            Nombre
          </div>
        </th>
        <th>
          <div class="flex items-center gap-2">
            <i class="material-icons-outlined text-sm">description</i>
            Descripción
          </div>
        </th>
        <th>
          <div class="flex items-center gap-2">
            <i class="material-icons-outlined text-sm">image</i>
            Imagen
          </div>
        </th>
        <th class="text-center">Acciones</th>
      </tr>
    </thead>
    <tbody>
      @if (categoriesResource.isLoading()) {
        <tr>
          <td colspan="4">
            <div class="flex justify-center p-4">
              <span
                class="loading loading-spinner loading-lg text-primary"
              ></span>
            </div>
          </td>
        </tr>
      } @else if (categoriesResource.error()) {
        <tr>
          <td colspan="4">
            <div class="alert alert-error mt-4">
              <i class="material-symbols-outlined !text-xl">error</i>
              <span>{{ categoriesResource.error() }}</span>
              <button class="btn btn-sm" (click)="reload()">Reintentar</button>
            </div>
          </td>
        </tr>
      } @else {
        @for (category of categoriesResource.value() ?? []; track category.id) {
          <tr class="hover">
            <td>
              <div class="font-medium">
                {{ category.localizedName["es"] || "Sin nombre" }}
              </div>
            </td>
            <td>
              <div class="text-sm opacity-70">
                {{ category.localizedDescription["es"] || "Sin descripción" }}
              </div>
            </td>
            <td>
              <div class="avatar">
                <div class="w-8 h-8 rounded-full">
                  <img
                    [src]="category.imageUrl"
                    alt="Category Icon"
                    class="object-cover"
                    onerror="this.src='assets/images/placeholder.png'"
                  />
                </div>
              </div>
            </td>
            <td>
              <div class="flex items-center justify-center gap-1">
                <div class="tooltip" data-tip="Editar categoría">
                  <modal-open-button
                    [modalName]="'modal_activity_category'"
                    [type]="'icon'"
                    classes="btn btn-ghost btn-sm"
                    (click)="openEditModal(category)"
                  >
                    <i class="material-icons-outlined text-lg text-primary"
                      >edit</i
                    >
                  </modal-open-button>
                </div>

                <div class="tooltip" data-tip="Eliminar categoría">
                  <modal-open-button
                    [modalName]="'modal_activity_category_delete'"
                    [type]="'icon'"
                    classes="btn btn-ghost btn-sm"
                    (click)="deleteCategory(category)"
                  >
                    <i class="material-icons-outlined text-lg text-error"
                      >delete</i
                    >
                  </modal-open-button>
                </div>
              </div>
            </td>
          </tr>
        } @empty {
          <tr>
            <td colspan="4" class="text-center py-8">
              <div class="flex flex-col items-center gap-2">
                <i class="material-icons-outlined text-4xl text-base-300"
                  >category</i
                >
                <p class="text-base-content/70">
                  No se encontraron categorías.
                </p>
              </div>
            </td>
          </tr>
        }
      }
    </tbody>
  </table>
</div>

<app-category-modal
  (close)="reload()"
  [category]="selectedCategory()"
  (reload)="reload()"
></app-category-modal>

<app-dialog
  [title]="'Delete activity category'"
  [message]="'Are you sure you want to delete this activity category?'"
  [modalName]="'modal_activity_category_delete'"
  [buttonText]="'Delete'"
  (callback)="deleteConfirmed()"
></app-dialog>
